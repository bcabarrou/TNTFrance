{extends file="admin-layout.tpl"}

{block name="no-return-functions"}
    {$admin_current_location = 'modules'}
{/block}

{block name="page-title"}{intl d="tntfrance.bo.default" l='TNTFrance configuration'}{/block}

{block name="check-resource"}admin.module{/block}
{block name="check-access"}view{/block}
{block name="check-module"}TNTFrance{/block}

{block name="main-content"}
    <div class="container" id="wrapper">
        <ul class="breadcrumb">
            <li><a href="{url path='/admin'}">{intl l="Home" d="tntfrance.bo.default"}</a></li>
            <li><a href="{url path='/admin/modules'}">{intl l="Modules" d="tntfrance.bo.default"}</a></li>
            <li>{intl l="TNTFrance configuration" d="tntfrance.bo.default"}</li>
        </ul>

        <div class="general-block-decorator">
            <div class="title title-without-tabs">
                {intl l="Configure tntfrance" d="tntfrance.bo.default"}
            </div>

            <div class="row">
                <div class="col-md-12">
                    {if $success}
                        <div class="alert alert-success">
                            {intl l="Configuration correctly saved" d="tntfrance.bo.default"}
                        </div>
                    {/if}

                    {form name="tntfrance.configuration"}
                        <form id="configuration_form" action="{$current_url}" method="post">
                            {include "includes/inner-form-toolbar.html" hide_flags = 1 close_url={url path='/admin/modules'}}
                            <br/>

                            {form_field form=$form field="success_url"}
                            <input type="hidden" name="{$name}" value="{url path='/admin/modules'}" />
                            {/form_field}

                            {form_hidden_fields form=$form}

                            {form_field form=$form field="enabled"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="enabled"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="mode_production"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="mode_production"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="account_number"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="account_number"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="username"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="username"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="password"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="password"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="use_individual"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="use_individual"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="use_enterprise"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="use_enterprise"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="use_depot"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="use_depot"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="use_dropoffpoint"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="use_dropoffpoint"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}

                            {*
                            N : 8:00 Express
                            A : 9:00 Express
                            T : 10:00 Express
                            M : 12:00 Express
                            J : Express
                            P : Express (P)
                            *}
                            {form_field form=$form field="products_enabled"}
                            <div class="form-group {if $error}has-error{/if}">

                                <div>
                                    <strong>{$label}</strong>
                                </div>

                                <label class="control-label" for="product_N">
                                    <input type="checkbox" name="product" id="product_N" value="N" /> {intl l="8:00 Express" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="product_A">
                                    <input type="checkbox" name="product" id="product_A" value="A" /> {intl l="9:00 Express" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="product_T">
                                    <input type="checkbox" name="product" id="product_T" value="T" /> {intl l="10:00 Express" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="product_M">
                                    <input type="checkbox" name="product" id="product_M" value="M" /> {intl l="12:00 Express" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="product_J">
                                    <input type="checkbox" name="product" id="product_J" value="J" /> {intl l="Express" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="product_P">
                                    <input type="checkbox" name="product" id="product_P" value="P" /> {intl l="Express (P)" d="tntfrance.bo.default"}
                                </label>

                                {form_error form=$form field="products_enabled"}

                                <br />
                                <span class="error">{$message}</span>
                                {/form_error}

                                <input type="hidden" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}

                            {*
                            P : Retour de paiement
                            W : Expédition Sous Protection
                            D : Relais Colis
                            Z : Livraison à domicile
                            E : Livraison Possible Sans Emargement
                            *}
                            {form_field form=$form field="options_enabled"}
                            <div class="form-group {if $error}has-error{/if}">

                                <div>
                                    <strong>{$label}</strong>
                                </div>

                                <label class="control-label" for="option_P">
                                    <input type="checkbox" name="option" id="option_P" value="P" /> {intl l="Retour de paiement" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="option_W">
                                    <input type="checkbox" name="option" id="option_W" value="W" /> {intl l="Expédition Sous Protection" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="option_D">
                                    <input type="checkbox" name="option" id="option_D" value="D" /> {intl l="Relais Colis" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="option_Z">
                                    <input type="checkbox" name="option" id="option_Z" value="Z" /> {intl l="Livraison à domicile" d="tntfrance.bo.default"}
                                </label>
                                <label class="control-label" for="option_E">
                                    <input type="checkbox" name="option" id="option_E" value="E" /> {intl l="Livraison Possible Sans Emargement" d="tntfrance.bo.default"}
                                </label>

                                {form_error form=$form field="options_enabled"}
                                <br />
                                <span class="error">{$message}</span>
                                {/form_error}

                                <input type="hidden" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="regular_pickup"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="regular_pickup"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="sender_name"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="sender_name"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="sender_address1"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="sender_address1"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="sender_address2"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="sender_address2"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="sender_zip_code"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="sender_zip_code"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="sender_city"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="sender_city"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="contact_lastname"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="contact_lastname"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="contact_firstname"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="contact_firstname"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="contact_email"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="contact_email"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="contact_phone"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="contact_phone"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="notification_emails"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="notification_emails"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}
                            {form_field form=$form field="notification_success"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="notification_success"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}

                            {form_field form=$form field="label_format"}
                            <div class="form-group {if $error}has-error{/if}">
                                <div>
                                    <strong>{$label}</strong>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input type="radio" name="u_label_format" class="label_format_stda4" value="STDA4" >
                                        {intl l="A4 print" d="tntfrance.bo.default"}
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input type="radio" name="u_label_format" class="label_format_thermal" value="THERMAL" >
                                        {intl l="printing on thermal printer" d="tntfrance.bo.default"}
                                    </label>
                                </div>
                                <div class="col-md-offset-1">
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" class="label_format_thermal_no_logo" value="NO_LOGO" >
                                            {intl l="TNT logo is not printed on the label" d="tntfrance.bo.default"}
                                        </label>
                                    </div>
                                    <div class="checkbox">
                                        <label>
                                            <input type="checkbox" class="label_format_thermal_rotate_180" value="ROTATE_180" >
                                            {intl l="reverse printing" d="tntfrance.bo.default"}
                                        </label>
                                    </div>
                                </div>


                                {form_error form=$form field="label_format"}
                                <br />
                                <span class="error">{$message}</span>
                                {/form_error}

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />

                                {if ! empty($label_attr.help)}
                                    <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}

                            {form_field form=$form field="free_shipping"}
                                <div class="form-group {if $error}has-error{/if}">
                                    <label class="control-label" for="{$label_attr.for}">
                                        <input type="checkbox" name="{$name}" id="{$label_attr.for}" {if $value}checked{/if} />
                                        {$label}
                                        {if $required}<span class="required">*</span>{/if}

                                        {form_error form=$form field="notification_success"}
                                            <br />
                                            <span class="error">{$message}</span>
                                        {/form_error}
                                    </label>

                                    {if ! empty($label_attr.help)}
                                        <span class="help-block">{$label_attr.help}</span>
                                    {/if}
                                </div>
                            {/form_field}

                            {form_field form=$form field="max_weight_package"}
                            <div class="form-group {if $error}has-error{/if}">
                                <label class="control-label" for="{$label_attr.for}">
                                    {$label}
                                    {if $required}<span class="required">*</span>{/if}

                                    {form_error form=$form field="max_weight_package"}
                                    <br />
                                    <span class="error">{$message}</span>
                                    {/form_error}
                                </label>

                                <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                {if ! empty($label_attr.help)}
                                <span class="help-block">{$label_attr.help}</span>
                                {/if}
                            </div>
                            {/form_field}

                            {form_field form=$form field="tracking_url"}
                                <div class="form-group {if $error}has-error{/if}">
                                    <label class="control-label" for="{$label_attr.for}">
                                        {$label}
                                        {if $required}<span class="required">*</span>{/if}

                                        {form_error form=$form field="label_format"}
                                            <br />
                                            <span class="error">{$message}</span>
                                        {/form_error}
                                    </label>

                                    <input type="text" class="form-control" name="{$name}" id="{$label_attr.for}" value="{$value}" />
                                    {if ! empty($label_attr.help)}
                                        <span class="help-block">{$label_attr.help}</span>
                                    {/if}
                                </div>
                            {/form_field}

                            {include "includes/inner-form-toolbar.html" hide_flags = 1 close_url={url path='/admin/modules'} page_bottom = 1}
                        </form>
                    {/form}
                </div>
            </div>
        </div>
    </div>
{/block}

{block name="javascript-initialization"}
<script type="text/javascript">
    (function ($) {
        $(document).ready(function () {
            var products = $('#products_enabled').val(),
                options = $('#options_enabled').val(),
                labelFormat = $('#label_format').val();

            $('input[name="product"]').val(products.split(","));
            $('input[name="option"]').val(options.split(","));

            $('input.label_format_stda4').prop("checked", (-1 !== labelFormat.indexOf("STDA4")));
            $('input.label_format_thermal').prop("checked", (-1 !== labelFormat.indexOf("THERMAL")));
            $('input.label_format_thermal_no_logo').prop("checked", (-1 !== labelFormat.indexOf("NO_LOGO")));
            $('input.label_format_thermal_rotate_180').prop("checked", (-1 !== labelFormat.indexOf("ROTATE_180")));

            //$('input[name="product"]').val(products.split(","));

            $("#configuration_form").on("submit", function() {
                var productsEnabled = $('input:checkbox[name=product]:checked').map(function() {
                    return this.value;
                }).get();
                var optionsEnabled = $('input:checkbox[name=option]:checked').map(function() {
                    return this.value;
                }).get();
                var labelFormatValue = [];

                $('#products_enabled').val(productsEnabled.join(','));
                $('#options_enabled').val(optionsEnabled.join(','));

                if ($('input.label_format_stda4').prop("checked")) {
                    labelFormatValue.push('STDA4');
                } else {
                    labelFormatValue.push('THERMAL');

                    if ($('input.label_format_thermal_no_logo').prop("checked")) {
                        labelFormatValue.push('NO_LOGO');
                    }
                    if ($('input.label_format_thermal_rotate_180').prop("checked")) {
                        labelFormatValue.push('ROTATE_180');
                    }
                }

                $('#label_format').val(labelFormatValue.join(','));
            });


        });
    })(jQuery);
</script>
{/block}